from defisheye import Defisheye
import cv2

# Load the fisheye image
input_image_path = "fisheye_image.jpg"
img = cv2.imread(input_image_path)

# Configuration: projection='linear' (other options: 'cylindrical', 'stereographic', etc.)
# You can tweak `fov_deg` and `pfov` if needed for better results
params = {
    "fov_deg": 180,       # Field of view in degrees (adjust based on your lens)
    "pfov": 120,          # Perspective FOV (smaller = more zoomed)
    "xcenter": 0.5,       # X-center of image (0 to 1, default 0.5)
    "ycenter": 0.5,       # Y-center of image (0 to 1, default 0.5)
    "projection": "linear"  # Output projection
}

# Create Defisheye object
d = Defisheye(img.shape[1], img.shape[0], **params)

# Undistort image
undistorted_img = d.convert(img)

# Save or display result
cv2.imwrite("undistorted_image.jpg", undistorted_img)
cv2.imshow("Undistorted", undistorted_img)
cv2.waitKey(0)
cv2.destroyAllWindows()
